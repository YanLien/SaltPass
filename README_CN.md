# SaltPass

🔐 基于加密算法的确定性密码生成器。只需记住一个盐值，结合公开的特征标识符，即可为每个账户生成唯一且强健的密码。无需密码保险库，无需云同步，安全尽在掌握。

## ✨ 特性

- 🔑 **确定性生成**：相同的盐值 + 特征 = 相同的密码，始终如一
- 🧠 **仅内存存储**：主盐值永不写入磁盘
- 🔒 **多种算法**：支持 HMAC-SHA256、Argon2i、Argon2id、Pbkdf2、Scrypt
- 📋 **自动剪贴板**：生成的密码自动复制到剪贴板
- 💾 **本地存储**：特征存储在 `~/.saltpass/features.toml`
- 🎨 **精美 CLI**：交互式彩色命令行界面
- 🧹 **内存安全**：使用 `zeroize` 在退出时自动清零盐值
- ⚙️ **按特征选择算法**：为每个特征选择不同的密码生成算法

## 🚀 快速开始

### 安装

```bash
# 克隆仓库
git clone https://github.com/YanLien/SaltPass.git
cd SaltPass

# 构建并运行
cargo run --release
```

### 构建二进制文件

```bash
cargo build --release
# 二进制文件位于：./target/release/SaltPass
```

## 📖 使用方法

### 工作流程

```
1. 启动应用程序
      ↓
2. 输入主盐值（仅存储在内存中）
      ↓
3. 从菜单选择操作
      ↓
4. 生成密码 / 添加特征 / 管理特征
      ↓
5. 密码自动复制到剪贴板
      ↓
6. 退出 → 盐值从内存中清除
```

### 示例会话

```bash
$ ./target/release/SaltPass

🔐 欢迎使用 SaltPass - 确定性密码生成器
📁 存储位置：/Users/username/.saltpass/features.toml

🔑 输入您的主盐值（隐藏）：********
✅ 盐值已接受（仅存储在内存中）

? 您想做什么？
❯ 生成密码
  添加新特征
  列出所有特征
  删除特征
  退出
```

### 添加特征

```
特征名称：GitHub
特征标识符：github.com

? 选择密码生成算法
❯ HMAC-SHA256 - 快速（推荐用于密码生成）
  Argon2i - 内存密集（较慢，更安全）
  Argon2id - 混合模式（平衡）
  PBKDF2 - 标准（兼容性好）
  Scrypt - 内存密集（较慢）

提示（可选，按 Enter 跳过）：个人账户
✅ 特征 'GitHub' 添加成功！
```

### 生成密码

```
? 选择要生成密码的特征
❯ [HMAC-SHA256] GitHub (github.com) - 个人账户

密码长度（12-64）：16

🎯 生成的密码：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
特征：GitHub (github.com)
算法：HMAC-SHA256
密码：Xy3!bN7kLmP9QrSt
长度：16
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 密码已复制到剪贴板！
```

## 🏗️ 架构设计

### 数据结构

```rust
// Salt - 仅存储在内存中，丢弃时自动清零
struct Salt {
    salt_value: String  // 受 zeroize 保护
}

// Feature - 存储在磁盘上
struct Feature {
    name: String,           // 显示名称（如 "GitHub"）
    feature: String,        // 标识符（如 "github.com"）
    algorithm: Algorithm,   // 密码生成算法
    created: DateTime<Utc>, // 创建时间戳
    hint: Option<String>    // 可选提醒
}

// Algorithm - 可用的密码生成算法
enum Algorithm {
    HmacSha256,   // 快速（默认，推荐）
    Argon2i,      // 内存密集（较慢）
    Argon2id,     // 混合模式
    Pbkdf2,       // 标准 PBKDF2-HMAC-SHA256
    Scrypt,       // 内存密集（较慢）
}
```

### 密码生成算法

```
输入：盐值 + 特征 + 算法
        ↓
    密钥派生函数（KDF）
        ↓
    (HMAC-SHA256 | Argon2i | Argon2id | PBKDF2 | Scrypt)
        ↓
    Base64 编码
        ↓
格式化与增强（确保包含大写字母、数字、特殊字符）
        ↓
输出：强密码
```

### 支持的算法

| 算法 | 类型 | 速度 | 安全性 | 适用场景 |
|-----------|------|-------|----------|----------|
| **HMAC-SHA256** | 快速 | ⚡⚡⚡ | 🔒🔒🔒 | 默认，推荐用于密码生成 |
| **Argon2i** | 内存密集 | ⚡ | 🔒🔒🔒🔒 | 最高安全性，较慢 |
| **Argon2id** | 混合 | ⚡⚡ | 🔒🔒🔒🔒 | 平衡安全性和性能 |
| **PBKDF2** | 标准 | ⚡⚡ | 🔒🔒🔒 | 广泛兼容性 |
| **Scrypt** | 内存密集 | ⚡ | 🔒🔒🔒🔒 | 抗 ASIC，较慢 |

## 🛠️ 技术细节

### 依赖项

- **serde**：序列化/反序列化
- **serde_json**：JSON 支持（可选）
- **toml**：TOML 存储格式（默认）
- **sha2**：SHA-256 哈希
- **hmac**：HMAC 实现
- **argon2**：Argon2i/Argon2id 密码哈希
- **pbkdf2**：PBKDF2-HMAC-SHA256
- **scrypt**：Scrypt 密码哈希
- **base64**：Base64 编码
- **dialoguer**：交互式 CLI
- **arboard**：剪贴板集成
- **zeroize**：安全内存清零
- **chrono**：时间戳处理
- **dirs**：平台特定目录

### 存储位置

- **macOS/Linux**：`~/.saltpass/features.toml`
- **Windows**：`C:\Users\Username\.saltpass/features.toml`

### 安全特性

1. **内存保护**：盐值使用带有 `ZeroizeOnDrop` trait 的 `zeroize` crate
2. **无磁盘存储**：主盐值永不写入磁盘
3. **确定性**：无随机性，可重现的密码
4. **离线优先**：无网络，无云服务，无第三方

## 🧪 测试

```bash
# 运行所有测试
cargo test

# 详细输出测试
cargo test -- --nocapture
```

## 📝 版本更新

要更新密码（例如在泄露后），修改特征标识符：

```
原始：github.com
更新：github.com.v2
新版：github.com.v3
```

每个版本都会生成完全不同的密码。

## 🗺️ 未来路线图

### 密码管理
- [ ] 🔄 **密码版本系统**：内置版本管理，用于密码轮换（如 `github.com.v2`）
- [ ] ⚙️ **自定义密码策略**：针对每个特征的密码强度配置（长度、字符集）
- [ ] 📊 **使用统计**：跟踪最后使用时间、生成次数、密码过期提醒
- [ ] 🔔 **轮换提醒**：旧密码的智能通知（90天以上）
- [ ] 📦 **导出/导入**：备份和恢复特征配置（而非密码）

### 多配置文件支持
- [ ] 🔐 **多盐值配置**：独立的工作/个人/家庭盐值配置
- [ ] 🏷️ **特征标签**：按类别组织特征（社交、银行、工作等）
- [ ] 🔍 **高级搜索**：按标签、年龄或使用频率快速过滤

### 安全增强
- [ ] 🗑️ **自动清除剪贴板**：可配置的超时时间来清除已复制的密码
- [ ] 🔒 **可选特征加密**：使用主密码加密存储的特征名称
- [ ] 🔐 **双因素盐值**：将主盐值与设备特定盐值结合
- [ ] 🛡️ **泄露检测**：离线检查特征域是否在已知泄露数据库中

### 用户体验
- [ ] 🎨 **GUI 版本**：使用 egui/iced 框架的桌面应用
- [ ] 🌐 **浏览器扩展**：一键密码生成和自动填充
- [ ] 📱 **移动应用**：支持跨设备特征同步的 iOS/Android 应用
- [ ] ⌨️ **快速访问模式**：热键触发的浮动窗口

### 跨平台
- [ ] ☁️ **特征文件同步**：iCloud/Dropbox/Git 特征配置同步
- [ ] 🔄 **冲突解决**：多设备特征更新的智能合并
- [ ] 📲 **二维码传输**：设备间快速特征传输

### 开发者功能
- [ ] 🔌 **插件系统**：自定义密码生成算法
- [ ] 🛠️ **CLI 改进**：脚本支持、JSON 输出、批量操作
- [ ] 📚 **API 库**：在其他项目中将 SaltPass 作为 Rust 库使用

## 非目标

为了保持安全性和简洁性，我们**不会**实现：
- ❌ 存储生成的密码（违背确定性目的）
- ❌ 云密码同步（增加攻击面）
- ❌ 无盐值的密码恢复（设计上不可能）
- ❌ 内置密码共享（改用确定性生成）

## 📜 许可证

MIT License - 详见 LICENSE 文件

## 🤝 贡献

欢迎贡献！请随时提交 Pull Request。

## ⚠️ 安全提示

### 关键：主盐值管理

- **记住您的盐值**：丢失盐值 = 永久丢失**所有**密码的访问权限
- **保持盐值私密**：绝不与任何人分享您的主盐值
- **备份特征**：在设备间同步 `~/.saltpass/features.toml`
- **使用唯一盐值**：与您现有的任何密码不同

### 推荐的盐值备份策略

选择以下方法中的**一种或多种**：

1. **记忆宫殿**（最安全）
   - 创建一个只有您知道的难忘短语/公式
   - 例如："FirstPet + BirthYear + FavoriteColor" → Fluffy1990Blue
   - **不要**准确写下这个公式

2. **物理备份**（平衡）
   - 将盐值写在纸上，存放在保险箱中
   - 分成多个部分，存放在不同的安全位置
   - 使用密码管理器存储盐值（虽然讽刺，但实用）

3. **加密数字备份**
   - 存储在安全地方的加密 USB 驱动器中
   - 使用 KeePass/1Password 仅存储主盐值
   - 使用单独的密码短语加密并本地存储

4. **Shamir 秘密共享**（高级）
   - 将盐值分成 3 部分，需要任意 2 部分才能恢复
   - 将部分分发给可信赖的家人/朋友
   - 使用 `sssss`（Shamir 秘密共享方案）等工具

### 如果我忘记盐值怎么办？

**没有恢复选项。**这是为了最大安全性而设计的。

如果您丢失了盐值：
1. 导出您的特征列表：`~/.saltpass/features.toml`
2. 访问每个网站并使用"忘记密码"
3. 创建一个**新**的盐值并重新开始
4. 删除旧特征，使用新密码添加新特征

### 盐值验证

首次设置时，SaltPass 将：
- 询问可选提示（本地存储）
- 创建验证哈希（以确认正确的盐值输入）
- **绝不存储实际的盐值**


+ 支持随时退出
+ 确定性生成算法
